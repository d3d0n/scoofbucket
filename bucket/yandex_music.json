{
    "version": "5.46.0",
    "description": "Yandex Music Desktop",
    "homepage": "https://music.yandex.ru",
    "license": "Proprietary",
    "architecture": {
        "64bit": {
            "url": "https://music-desktop-application.s3.yandex.net/stable/Yandex_Music_x64_5.46.0.exe#/dl.7z"
        }
    },
    "installer": {
        "script": [
            "Write-Host \"Searching for app-64.7z...\"",
            "Get-ChildItem \"$dir\" -Recurse | ForEach-Object { Write-Host $_.FullName }",
            "if (Test-Path \"$dir\\`$PLUGINSDIR\\app-64.7z\") {",
            "    Write-Host \"Found at $dir\\`$PLUGINSDIR\\app-64.7z\"",
            "    Expand-7zipArchive \"$dir\\`$PLUGINSDIR\\app-64.7z\" \"$dir\" | Out-Null",
            "    # Дадим системе время на завершение распаковки",
            "    Start-Sleep -Seconds 2",
            "} else {",
            "    Write-Host \"Could not find app-64.7z!\"",
            "    exit 1",
            "}",
            "",
            "# Выведем список файлов в корне после распаковки",
            "Write-Host \"Files in root directory after extraction:\"",
            "Get-ChildItem \"$dir\" -File | ForEach-Object { Write-Host $_.FullName }",
            "",
            "# Выведем все exe-файлы для отладки",
            "Write-Host \"All EXE files:\"",
            "Get-ChildItem \"$dir\" -Filter \"*.exe\" -Recurse | ForEach-Object { Write-Host $_.FullName }",
            "",
            "# Найдем Яндекс Музыка.exe среди всех exe-файлов",
            "$yandexMusicExe = Get-ChildItem \"$dir\" -Filter \"*.exe\" -Recurse | Where-Object { $_.Name -match \"Яндекс\" -or $_.Name -match \"Yandex\" } | Select-Object -First 1",
            "",
            "if ($yandexMusicExe) {",
            "    Write-Host \"Found Яндекс Музыка.exe at: $($yandexMusicExe.FullName)\"",
            "    # Попробуем переместить файл в корень, если он не там",
            "    if ($yandexMusicExe.DirectoryName -ne $dir) {",
            "        $destPath = Join-Path $dir $yandexMusicExe.Name",
            "        Write-Host \"Moving exe to: $destPath\"",
            "        Copy-Item -Path $yandexMusicExe.FullName -Destination $destPath -Force",
            "        # Используем новый путь, если файл успешно скопирован",
            "        if (Test-Path $destPath) {",
            "            $yandexMusicExe = Get-Item $destPath",
            "        }",
            "    }",
            "",
            "    # Убедимся, что current ссылается на текущую версию",
            "    $currentDir = Join-Path (Split-Path $dir -Parent) \"current\"",
            "    Write-Host \"Current directory: $currentDir\"",
            "    ",
            "    # Создание ярлыка с проверкой",
            "    $s = Join-Path $env:APPDATA 'Microsoft\\Windows\\Start Menu\\Programs\\Яндекс Музыка.lnk'",
            "    $t = $yandexMusicExe.FullName",
            "    Write-Host \"Creating shortcut: $s -> $t\"",
            "    ",
            "    try {",
            "        # Убедимся, что папка для ярлыка существует",
            "        $shortcutDir = Join-Path $env:APPDATA 'Microsoft\\Windows\\Start Menu\\Programs'",
            "        if (!(Test-Path $shortcutDir)) {",
            "            New-Item -Path $shortcutDir -ItemType Directory -Force | Out-Null",
            "        }",
            "",
            "        # Метод 1: Использование WScript.Shell без дополнительных параметров",
            "        $ws = New-Object -ComObject WScript.Shell",
            "        $lnk = $ws.CreateShortcut($s)",
            "        $lnk.TargetPath = $t",
            "        # Минимальный набор параметров, без лишних свойств",
            "        # $lnk.WorkingDirectory = $yandexMusicExe.DirectoryName",
            "        # $lnk.IconLocation = \"$t,0\"",
            "        $lnk.Save()",
            "        Write-Host \"Shortcut created successfully\"",
            "    } catch {",
            "        Write-Host \"Error with method 1: $_\"",
            "        try {",
            "            # Метод 2: Использование пути на диск C: вместо переменных",
            "            $cmd = \"cmd /c mklink \"\"$s\"\" \"\"$t\"\"\"",
            "            Write-Host \"Executing: $cmd\"",
            "            Invoke-Expression $cmd",
            "            Write-Host \"Shortcut created with method 2\"",
            "        } catch {",
            "            Write-Host \"Error with method 2: $_\"",
            "        }",
            "    }",
            "} else {",
            "    Write-Host \"Could not find any Yandex Music executable!\"",
            "    exit 1",
            "}"
        ]
    },
    "checkver": {
        "url": "https://music-desktop-application.s3.yandex.net/stable/",
        "regex": "Yandex_Music_x64_([\\d.]+)\\.exe"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://music-desktop-application.s3.yandex.net/stable/Yandex_Music_x64_$version.exe#/dl.7z"
            }
        }
    }
}
